<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>ä½œå“é›† | xaDGitHub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #0f1216;
      --card: #141a21;
      --text: #e8edf2;
      --muted: #9aa7b1;
      --accent: #5ac8fa;
      --accent2: #7ee787;
      --border: #24303a;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Helvetica, Arial;
      background: radial-gradient(1200px 600px at 20% -10%, #1b2230 0%, var(--bg) 40%) no-repeat, var(--bg);
      color: var(--text);
    }
    header {
      max-width: 1200px; margin: 40px auto 24px; padding: 0 20px;
    }
    h1 { margin: 0 0 8px; font-size: 28px; letter-spacing: .5px; }
    .sub { color: var(--muted); font-size: 14px; }
    .toolbar { display: flex; gap: 8px; align-items: center; margin-top: 12px; }
    .btn {
      background: linear-gradient(180deg, #1b2330, var(--card));
      border: 1px solid var(--border);
      color: var(--text); border-radius: 10px; padding: 10px 14px;
      font-size: 14px; cursor: pointer;
    }
    .btn:hover { border-color: #334355; }

    .grid {
      max-width: 1200px; margin: 12px auto 40px; padding: 0 20px;
      display: grid; grid-template-columns: repeat(auto-fill,minmax(240px,1fr)); gap: 16px;
    }
    .card {
      position: relative; overflow: hidden; border-radius: 16px;
      background: linear-gradient(180deg, #18202a, var(--card));
      border: 1px solid var(--border);
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      transition: transform .2s ease, border-color .2s ease;
      cursor: pointer;
      min-height: 160px;
    }
    .card:hover { transform: translateY(-2px); border-color: #38506a; }
    .card .name {
      position: absolute; left: 14px; bottom: 14px; right: 14px;
      font-weight: 600; font-size: 16px;
    }
    .card .meta {
      position: absolute; left: 14px; top: 12px; font-size: 12px; color: var(--muted);
    }

    /* Gallery */
    .gallery {
      max-width: 1200px; margin: 12px auto 60px; padding: 0 20px;
    }
    .breadcrumbs {
      display: flex; align-items: center; gap: 8px; color: var(--muted); font-size: 14px; margin-bottom: 12px;
    }
    .breadcrumbs a { color: var(--accent); text-decoration: none; }
    .folder-title { font-size: 20px; font-weight: 700; margin: 8px 0 16px; }
    .thumbs {
      display: grid; grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); gap: 12px;
    }
    .thumb {
      position: relative; border-radius: 12px; overflow: hidden; border: 1px solid var(--border);
      background: #0c0f14; cursor: pointer;
    }
    .thumb img, .thumb .pdf {
      width: 100%; height: 160px; object-fit: cover; display: block;
      background: #0c0f14;
    }
    .thumb .label {
      position: absolute; left: 8px; bottom: 8px; right: 8px; font-size: 12px; color: var(--muted);
      text-shadow: 0 1px 4px rgba(0,0,0,.6);
    }
    .thumb:hover { border-color: #3a5068; }

    /* Lightbox */
    .lightbox {
      position: fixed; inset: 0; background: rgba(0,0,0,.8);
      display: none; align-items: center; justify-content: center; z-index: 1000;
    }
    .lightbox.open { display: flex; }
    .lightbox img {
      max-width: 94vw; max-height: 94vh; border-radius: 10px; box-shadow: 0 12px 36px rgba(0,0,0,.45);
    }
    .lightbox .close {
      position: fixed; top: 16px; right: 16px; background: rgba(20,24,30,.8);
      color: var(--text); border: 1px solid var(--border); padding: 10px 12px; border-radius: 10px; cursor: pointer;
    }
    .empty { color: var(--muted); padding: 20px; border: 1px dashed var(--border); border-radius: 12px; background: #11161d; }
    .notice { color: var(--muted); font-size: 13px; margin-top: 10px; }
    .link { color: var(--accent2); text-decoration: none; }
  </style>
</head>
<body>
  <header>
    <h1>æˆ‘çš„å‰ç«¯ä½œå“é›†</h1>
    <div class="sub">ç‚¹å‡»å„ä½œå“æ–‡ä»¶å¤¹æŸ¥çœ‹é¢„è§ˆï¼Œå›¾ç‰‡æ”¯æŒå…¨å±é“ºæ»¡æŸ¥çœ‹ã€‚</div>
    <div class="toolbar">
      <button class="btn" id="backBtn" style="display:none">â† è¿”å›æ–‡ä»¶å¤¹åˆ—è¡¨</button>
      <a class="btn link" target="_blank" href="https://cdn.jsdelivr.net/gh/xaDGitHub/works@main/">é€šè¿‡ jsDelivr åŠ é€Ÿ</a>
      <a class="btn link" target="_blank" href="https://github.com/xaDGitHub/works">ä»“åº“</a>
    </div>
  </header>

  <!-- æ–‡ä»¶å¤¹æ …æ ¼ -->
  <section id="folderGrid" class="grid" aria-live="polite"></section>

  <!-- ä½œå“é¢„è§ˆ -->
  <section id="gallery" class="gallery" style="display:none">
    <div class="breadcrumbs"><a href="#" id="crumbHome">é¦–é¡µ</a> / <span id="crumbFolder"></span></div>
    <div class="folder-title" id="galleryTitle"></div>
    <div class="thumbs" id="thumbs"></div>
    <div class="notice">å›¾ç‰‡ä½¿ç”¨ jsDelivr CDN åŠ é€Ÿï¼›PDF å°†åœ¨æ–°çª—å£æ‰“å¼€ã€‚</div>
  </section>

  <!-- å…¨å±ç¯ç®± -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true">
    <button class="close" id="closeLightbox">âœ• å…³é—­</button>
    <img id="lightboxImg" alt="é¢„è§ˆ"/>
  </div>

<script>
(function(){
  const owner = 'xaDGitHub';
  const repo  = 'works';
  const branch = 'main'; // å¦‚ä½ çš„é»˜è®¤åˆ†æ”¯æ˜¯ masterï¼Œè¯·æ”¹ä¸º 'master'

  const apiBase = `https://api.github.com/repos/${owner}/${repo}/contents`;
  const cdnBase = `https://cdn.jsdelivr.net/gh/${owner}/${repo}@${branch}`;

  const folderGrid = document.getElementById('folderGrid');
  const gallery = document.getElementById('gallery');
  const thumbs = document.getElementById('thumbs');
  const galleryTitle = document.getElementById('galleryTitle');
  const crumbFolder = document.getElementById('crumbFolder');
  const backBtn = document.getElementById('backBtn');
  const crumbHome = document.getElementById('crumbHome');

  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightboxImg');
  const closeLightbox = document.getElementById('closeLightbox');

  const IMG_EXT = ['.jpg','.jpeg','.png','.webp','.gif','.avif'];
  const PDF_EXT = ['.pdf'];

  function extOf(name) {
    const i = name.lastIndexOf('.');
    return i >= 0 ? name.slice(i).toLowerCase() : '';
  }
  function isImg(name) { return IMG_EXT.includes(extOf(name)); }
  function isPdf(name) { return PDF_EXT.includes(extOf(name)); }

  function cdnUrl(path) {
    // ç§»é™¤å¼€å¤´çš„æ–œæ ï¼Œæ‹¼æˆ jsDelivr é“¾æ¥
    const clean = path.replace(/^\/+/, '');
    return `${cdnBase}/${clean}`;
  }

  async function fetchJSON(url) {
    const res = await fetch(url, { headers: { 'Accept':'application/vnd.github+json' } });
    if (!res.ok) throw new Error(`HTTP ${res.status} for ${url}`);
    return res.json();
  }

  // 1) åŠ è½½ä»“åº“æ ¹ç›®å½•ï¼Œåˆ—å‡ºæ–‡ä»¶å¤¹
  async function loadFolders() {
    folderGrid.innerHTML = '';
    gallery.style.display = 'none';
    backBtn.style.display = 'none';

    try {
      const items = await fetchJSON(apiBase);
      const dirs = items.filter(x => x.type === 'dir');
      if (dirs.length === 0) {
        folderGrid.innerHTML = `<div class="empty">æ ¹ç›®å½•æœªæ£€æµ‹åˆ°æ–‡ä»¶å¤¹ï¼Œè¯·åœ¨ä»“åº“æ ¹ç›®å½•åˆ›å»ºä½œå“æ–‡ä»¶å¤¹ã€‚</div>`;
        return;
      }
      dirs.forEach(d => {
        const card = document.createElement('div');
        card.className = 'card';
        card.setAttribute('role','button');
        card.setAttribute('aria-label', `æ‰“å¼€ ${d.name} æ–‡ä»¶å¤¹`);
        card.innerHTML = `
          <div class="meta">æ–‡ä»¶å¤¹</div>
          <div class="name">${d.name}</div>
        `;
        card.addEventListener('click', () => openFolder(d.path, d.name));
        folderGrid.appendChild(card);
      });
    } catch (e) {
      folderGrid.innerHTML = `<div class="empty">åŠ è½½æ–‡ä»¶å¤¹å¤±è´¥ï¼š${e.message}</div>`;
    }
  }

  // 2) æ‰“å¼€æŸæ–‡ä»¶å¤¹ï¼Œåˆ—å‡ºå›¾ç‰‡/PDFç¼©ç•¥
  async function openFolder(path, name) {
    folderGrid.innerHTML = '';
    gallery.style.display = 'block';
    backBtn.style.display = 'inline-block';
    galleryTitle.textContent = name;
    crumbFolder.textContent = name;
    thumbs.innerHTML = '';

    try {
      const children = await fetchJSON(`${apiBase}/${encodeURIComponent(name)}`);
      const assets = children.filter(x => x.type === 'file' && (isImg(x.name) || isPdf(x.name)));

      if (assets.length === 0) {
        thumbs.innerHTML = `<div class="empty">è¯¥æ–‡ä»¶å¤¹å†…æœªæ£€æµ‹åˆ°å›¾ç‰‡æˆ– PDF æ–‡ä»¶ã€‚</div>`;
        return;
      }

      assets.forEach(file => {
        const card = document.createElement('div');
        card.className = 'thumb';

        if (isImg(file.name)) {
          const img = document.createElement('img');
          img.loading = 'lazy';
          img.alt = file.name;
          img.src = cdnUrl(file.path);
          img.addEventListener('click', () => openLightbox(img.src, file.name));
          card.appendChild(img);
        } else if (isPdf(file.name)) {
          const pdfBox = document.createElement('div');
          pdfBox.className = 'pdf';
          pdfBox.style.display = 'grid';
          pdfBox.style.placeItems = 'center';
          pdfBox.style.background = 'linear-gradient(180deg,#18202a,#0c0f14)';
          pdfBox.innerHTML = `
            <div style="text-align:center">
              <div style="font-size:48px; line-height:1; color:#ff7b72">ğŸ“„</div>
              <div style="margin-top:6px; color:#cdd9e5; font-size:13px">PDF æ–‡æ¡£</div>
            </div>
          `;
          pdfBox.addEventListener('click', () => {
            window.open(cdnUrl(file.path), '_blank', 'noopener');
          });
          card.appendChild(pdfBox);
        }

        const label = document.createElement('div');
        label.className = 'label';
        label.textContent = file.name;
        card.appendChild(label);

        thumbs.appendChild(card);
      });

    } catch (e) {
      thumbs.innerHTML = `<div class="empty">åŠ è½½ä½œå“å¤±è´¥ï¼š${e.message}</div>`;
    }
  }

  // 3) ç¯ç®±å…¨å±
  function openLightbox(src, alt) {
    lightboxImg.src = src;
    lightboxImg.alt = alt || 'é¢„è§ˆ';
    lightbox.classList.add('open');
  }
  function closeBox() {
    lightbox.classList.remove('open');
    lightboxImg.src = '';
  }

  // äº‹ä»¶
  backBtn.addEventListener('click', loadFolders);
  crumbHome.addEventListener('click', (e)=>{ e.preventDefault(); loadFolders(); });
  closeLightbox.addEventListener('click', closeBox);
  lightbox.addEventListener('click', (e) => {
    if (e.target === lightbox) closeBox();
  });
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeBox();
  });

  // å¯åŠ¨
  loadFolders();
})();
</script>
</body>
</html>